<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PhotoMapperAI.UI.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="500"
             x:Class="PhotoMapperAI.UI.Views.ExtractStepView"
             x:DataType="vm:ExtractStepViewModel">

  <Design.DataContext>
    <vm:ExtractStepViewModel/>
  </Design.DataContext>

  <ScrollViewer>
    <StackPanel Margin="24" Spacing="20">
      <!-- Header -->
      <TextBlock Text="Step 1: Extract Player Data" 
                 FontSize="24" FontWeight="Bold" 
                 Foreground="#1976D2"/>
      <TextBlock Text="Extract player data from your database to a CSV file. This CSV will be used in the next steps."
                 FontSize="14" Foreground="#666" TextWrapping="Wrap"/>

      <Separator Margin="0,8"/>

      <!-- SQL File Selection -->
      <Border Background="#F5F5F5" CornerRadius="8" Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="ðŸ“ SQL Query File" FontSize="16" FontWeight="SemiBold"/>
          <TextBlock Text="Select a SQL file containing the query to extract player data"
                     FontSize="12" Foreground="#666"/>
          <Grid ColumnDefinitions="*,Auto">
            <TextBox Grid.Column="0" Text="{Binding SqlFilePath}" 
                     Watermark="Path to SQL file..."
                     IsReadOnly="True" Height="36"/>
            <Button Grid.Column="1" Content="Browse" 
                    Click="BrowseSqlFile_Click"
                    Margin="8,0,0,0" Padding="16,8"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- Connection String File -->
      <Border Background="#F5F5F5" CornerRadius="8" Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="ðŸ” Connection String File" FontSize="16" FontWeight="SemiBold"/>
          <TextBlock Text="Select a file containing your database connection string (kept separate for security)"
                     FontSize="12" Foreground="#666"/>
          <Grid ColumnDefinitions="*,Auto">
            <TextBox Grid.Column="0" Text="{Binding ConnectionStringPath}" 
                     Watermark="Path to connection string file..."
                     IsReadOnly="True" Height="36"/>
            <Button Grid.Column="1" Content="Browse" 
                    Click="BrowseConnectionStringFile_Click"
                    Margin="8,0,0,0" Padding="16,8"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- Database Type and Team ID -->
      <Grid ColumnDefinitions="*,*" Margin="0,8">
        <Border Grid.Column="0" Background="#F5F5F5" CornerRadius="8" Padding="16" Margin="0,0,8,0">
          <StackPanel Spacing="12">
            <TextBlock Text="ðŸ—„ï¸ Database Type" FontSize="16" FontWeight="SemiBold"/>
            <ComboBox ItemsSource="{Binding DatabaseTypes}" 
                      SelectedItem="{Binding DatabaseType}"
                      HorizontalAlignment="Stretch" Height="36"/>
          </StackPanel>
        </Border>

        <Border Grid.Column="1" Background="#F5F5F5" CornerRadius="8" Padding="16" Margin="8,0,0,0">
          <StackPanel Spacing="12">
            <TextBlock Text="ðŸ·ï¸ Team ID" FontSize="16" FontWeight="SemiBold"/>
            <NumericUpDown Value="{Binding TeamId}" 
                          Minimum="0" Maximum="999999"
                          HorizontalAlignment="Stretch" Height="36"/>
          </StackPanel>
        </Border>
      </Grid>

      <!-- Output File Name -->
      <Border Background="#F5F5F5" CornerRadius="8" Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="ðŸ“„ Output File Name" FontSize="16" FontWeight="SemiBold"/>
          <TextBox Text="{Binding OutputFileName}" 
                   Watermark="players.csv"
                   Height="36"/>
        </StackPanel>
      </Border>

      <!-- Execute Button -->
      <Button Content="â–¶ Extract Data" 
              Command="{Binding ExecuteExtractCommand}"
              IsEnabled="{Binding !IsProcessing}"
              Background="#4CAF50" Foreground="White"
              FontSize="16" Padding="24,12"
              HorizontalAlignment="Center"/>

      <!-- Status -->
      <Border Background="#E3F2FD" CornerRadius="8" Padding="16" 
              IsVisible="{Binding ProcessingStatus, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
        <StackPanel Spacing="8">
          <TextBlock Text="{Binding ProcessingStatus}" 
                     FontSize="14" TextWrapping="Wrap"/>
          <ProgressBar IsIndeterminate="True" 
                       IsVisible="{Binding IsProcessing}"
                       Height="4"/>
        </StackPanel>
      </Border>

      <!-- Success indicator -->
      <Border Background="#E8F5E9" CornerRadius="8" Padding="16"
              IsVisible="{Binding IsComplete}">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <TextBlock Text="âœ“" FontSize="20" Foreground="#4CAF50"/>
          <TextBlock Text="{Binding PlayersExtracted, StringFormat='Successfully extracted {0} players'}"
                     FontSize="14" Foreground="#2E7D32"/>
        </StackPanel>
      </Border>
    </StackPanel>
  </ScrollViewer>
</UserControl>
